#!/bin/bash
# ShellKeeper - Quick access wrapper

# Resolve the real path in case this is a symlink
REAL_SCRIPT="$(readlink -f "${BASH_SOURCE[0]}")"
SCRIPT_DIR="$(dirname "$REAL_SCRIPT")"
PYTHON_SCRIPT="$SCRIPT_DIR/shellkeeper.py"

# If no arguments, try to attach to most recent session or create new one
if [ $# -eq 0 ]; then
    # Check if any sessions exist
    if python3 "$PYTHON_SCRIPT" list 2>/dev/null | grep -q "No active sessions"; then
        echo "No active sessions. Creating new session..."
        python3 "$PYTHON_SCRIPT" new
    else
        python3 "$PYTHON_SCRIPT"
    fi
    exit $?
fi

# Handle quick shortcuts
case "$1" in
    h|help|-h|--help)
        python3 "$PYTHON_SCRIPT" --help
        ;;
    l|ls|list)
        python3 "$PYTHON_SCRIPT" list
        ;;
    n|new)
        shift
        python3 "$PYTHON_SCRIPT" new "$@"
        ;;
    a|attach)
        shift
        python3 "$PYTHON_SCRIPT" attach "$@"
        ;;
    k|kill)
        shift
        python3 "$PYTHON_SCRIPT" kill "$@"
        ;;
    r|rename)
        shift
        python3 "$PYTHON_SCRIPT" rename "$@"
        ;;
    c|clean)
        python3 "$PYTHON_SCRIPT" clean
        ;;
    i|info)
        shift
        python3 "$PYTHON_SCRIPT" info "$@"
        ;;
    note)
        shift
        python3 "$PYTHON_SCRIPT" note "$@"
        ;;
    cleanup)
        shift
        python3 "$PYTHON_SCRIPT" cleanup "$@"
        ;;
    doctor)
        python3 "$PYTHON_SCRIPT" doctor
        ;;
    log)
        shift
        python3 "$PYTHON_SCRIPT" log "$@"
        ;;
    dashboard|dash)
        python3 "$PYTHON_SCRIPT" dashboard
        ;;
    t|term|terminal)
        shift
        python3 "$PYTHON_SCRIPT" terminal "$@"
        ;;
    restore)
        shift
        python3 "$PYTHON_SCRIPT" restore "$@"
        ;;
    restore-all)
        python3 "$PYTHON_SCRIPT" restore-all
        ;;
    profiles)
        shift
        python3 "$PYTHON_SCRIPT" profiles "$@"
        ;;
    metadata)
        shift
        python3 "$PYTHON_SCRIPT" metadata "$@"
        ;;
    config)
        shift
        python3 "$PYTHON_SCRIPT" config "$@"
        ;;
    setup-autostart)
        python3 "$PYTHON_SCRIPT" setup-autostart
        ;;
    last)
        python3 "$PYTHON_SCRIPT" last
        ;;
    *)
        # If single argument that's not a command, assume it's a session name to attach
        if [ $# -eq 1 ]; then
            python3 "$PYTHON_SCRIPT" attach "$1"
        else
            python3 "$PYTHON_SCRIPT" "$@"
        fi
        ;;
esac
